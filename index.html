<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³–æœæœä½œä¸šç®¡ç† ğŸ¬</title>
    <style>
        :root {
            --primary: #FF9A9E;
            --secondary: #FECFEF;
            --accent: #a18cd1;
            --text: #555;
            --bg: #fdfbf7;
            --card-bg: #ffffff;
            --success: #84fab0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* é¡¶éƒ¨å¯¼èˆªä¸ç§¯åˆ†æ  */
        header {
            background: linear-gradient(120deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 20px;
            color: white;
            box-shadow: 0 4px 15px rgba(255, 154, 158, 0.4);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        
        .score-board {
            background: rgba(255, 255, 255, 0.3);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2rem;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* å¯¼èˆªåˆ‡æ¢ */
        .nav-tabs {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 20px;
        }

        .tab-btn {
            background: white;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 10px 30px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            font-weight: bold;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(255, 154, 158, 0.3);
        }

        /* ä¸»å®¹å™¨ */
        main {
            max-width: 800px;
            width: 95%;
            margin: 0 auto;
            flex: 1;
            padding-bottom: 50px;
        }

        .section { display: none; animation: fadeIn 0.5s; }
        .section.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ä½œä¸šæ·»åŠ åŒº */
        .add-task-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            border: 2px dashed var(--accent);
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr auto;
            gap: 10px;
            margin-top: 10px;
        }

        @media (max-width: 600px) {
            .input-group { grid-template-columns: 1fr; }
        }

        input, select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            outline: none;
        }

        button.btn-add {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
        }

        /* ä½œä¸šåˆ—è¡¨ */
        .task-list { list-style: none; padding: 0; }
        
        .task-card {
            background: white;
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.03);
            border-left: 5px solid #ddd;
            transition: transform 0.2s;
        }

        .task-card:hover { transform: translateY(-3px); }

        .task-info h3 { margin: 0 0 5px 0; color: #333; }
        .task-info p { margin: 0; font-size: 0.9rem; color: #888; }
        .task-subject { 
            display: inline-block; 
            background: #eee; 
            padding: 2px 8px; 
            border-radius: 4px; 
            font-size: 0.8rem; 
            margin-right: 5px;
            color: #555;
        }

        /* çŠ¶æ€æ ·å¼ */
        .status-pending { border-left-color: var(--accent); }
        .status-waiting { border-left-color: #ffd700; background: #fffdf0; }
        .status-done { border-left-color: var(--success); background: #f0fff4; opacity: 0.8; }

        .action-btn {
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
        }

        .btn-finish { background: white; border: 2px solid var(--accent); color: var(--accent); }
        .btn-finish:hover { background: var(--accent); color: white; }

        .btn-verify { background: #ffd700; color: #7a6a00; border: none; }
        
        .done-badge { color: var(--success); font-weight: bold; display: flex; align-items: center; gap: 5px; }

        /* å•†åŸç½‘æ ¼ */
        .mall-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
        }

        .product-icon { font-size: 3rem; margin-bottom: 10px; display: block; }
        .product-price { color: var(--primary); font-weight: bold; margin: 10px 0; }
        
        .btn-buy {
            background: var(--primary);
            color: white;
            border: none;
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .btn-buy:disabled { background: #ddd; cursor: not-allowed; }

        /* å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 300px;
            animation: popIn 0.3s;
        }
        @keyframes popIn { from { transform: scale(0.8); } to { transform: scale(1); } }
        
        .flower-anim {
            position: fixed;
            pointer-events: none;
            font-size: 50px;
            animation: floatUp 1.5s ease-out forwards;
            z-index: 2000;
        }
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(0.5); }
            50% { transform: translateY(-100px) scale(1.2); }
            100% { opacity: 0; transform: translateY(-200px) scale(1); }
        }

        /* ç®€å•æç¤º */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            opacity: 0;
            transition: opacity 0.3s;
        }

    </style>
</head>
<body>

<header>
    <h1>ğŸ¬ ç³–æœæœä½œä¸šç®¡ç†</h1>
    <div class="score-board">
        <span>ğŸŒº</span> <span id="score-display">0</span> åˆ†
    </div>
</header>

<div class="nav-tabs">
    <button class="tab-btn active" onclick="switchTab('homework')">ğŸ“ ä½œä¸šæœ¬</button>
    <button class="tab-btn" onclick="switchTab('mall')">ğŸ å…‘æ¢å•†åŸ</button>
</div>

<main>
    <div id="homework" class="section active">
        <div class="add-task-box">
            <h3>âœ¨ æ·»åŠ æ–°ä»»åŠ¡</h3>
            <div class="input-group">
                <select id="subject-input">
                    <option value="è¯­æ–‡">ğŸ“• è¯­æ–‡</option>
                    <option value="æ•°å­¦">ğŸ“ æ•°å­¦</option>
                    <option value="è‹±è¯­">ğŸ”¤ è‹±è¯­</option>
                    <option value="ç§‘å­¦">ğŸ”¬ ç§‘å­¦</option>
                    <option value="å…¶ä»–">ğŸ¨ å…¶ä»–</option>
                </select>
                <input type="text" id="task-desc" placeholder="ä¾‹å¦‚ï¼šèƒŒè¯µå¤è¯—ã€Šå’é¹…ã€‹">
                <input type="datetime-local" id="task-deadline">
                <button class="btn-add" onclick="addTask()">æ·»åŠ </button>
            </div>
        </div>

        <ul class="task-list" id="task-list-container">
            </ul>
    </div>

    <div id="mall" class="section">
        <div style="background: #fff3e0; padding: 15px; border-radius: 10px; margin-bottom: 20px; color: #d84315;">
            ğŸ’¡ æç¤ºï¼šåŠªåŠ›åšä½œä¸šèµšå–å°çº¢èŠ±ï¼Œå¯ä»¥å…‘æ¢ä¸‹é¢çš„å¥–åŠ±å“¦ï¼
        </div>
        <div class="mall-grid" id="mall-container">
            </div>
    </div>
</main>

<div id="parent-modal" class="modal">
    <div class="modal-content">
        <h2>ğŸ”’ å®¶é•¿ç¡®è®¤</h2>
        <p>è¯·è¾“å…¥ç¡®è®¤ç ï¼ˆé»˜è®¤8888ï¼‰</p>
        <input type="password" id="parent-pin" maxlength="4" style="text-align:center; letter-spacing: 5px; font-size: 20px; width: 100px; margin-bottom: 20px;">
        <div>
            <button class="btn-add" style="background:#ddd; color:#333" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="btn-add" onclick="verifyParent()">ç¡®å®š</button>
        </div>
    </div>
</div>

<div id="toast" class="toast">æç¤ºä¿¡æ¯</div>

<script>
    // --- æ•°æ®åˆå§‹åŒ– ---
    const DEFAULT_PIN = "8888"; // å®¶é•¿é»˜è®¤å¯†ç 
    let appData = {
        score: 0,
        tasks: [],
        products: [
            { id: 1, name: "çœ‹ç”µè§† 30åˆ†é’Ÿ", price: 5, icon: "ğŸ“º" },
            { id: 2, name: "åƒå†°æ·‡æ·‹", price: 10, icon: "ğŸ¦" },
            { id: 3, name: "ä¹°ä¸€ä¸ªç›²ç›’", price: 50, icon: "ğŸ" },
            { id: 4, name: "å»æ¸¸ä¹å›­", price: 200, icon: "ğŸ¡" },
            { id: 5, name: "ç©å¹³æ¿ 1å°æ—¶", price: 15, icon: "ğŸ“±" },
            { id: 6, name: "å…åšå®¶åŠ¡å¡", price: 20, icon: "ğŸ«" }
        ]
    };

    // é¡µé¢åŠ è½½è¯»å–æ•°æ®
    window.onload = function() {
        const savedData = localStorage.getItem('tangguoguoData');
        if (savedData) {
            appData = JSON.parse(savedData);
        }
        // è®¾ç½®é»˜è®¤æ—¶é—´ä¸ºå½“å‰æ—¶é—´
        const now = new Date();
        now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
        document.getElementById('task-deadline').value = now.toISOString().slice(0,16);
        
        renderAll();
    };

    function saveData() {
        localStorage.setItem('tangguoguoData', JSON.stringify(appData));
        renderAll();
    }

    function renderAll() {
        document.getElementById('score-display').innerText = appData.score;
        renderTasks();
        renderMall();
    }

    // --- ç•Œé¢åˆ‡æ¢ ---
    function switchTab(tabName) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        
        document.getElementById(tabName).classList.add('active');
        // ç®€å•ç²—æš´çš„é«˜äº®é€»è¾‘
        const btns = document.querySelectorAll('.tab-btn');
        if(tabName === 'homework') btns[0].classList.add('active');
        else btns[1].classList.add('active');
    }

    // --- ä½œä¸šé€»è¾‘ ---
    function addTask() {
        const subject = document.getElementById('subject-input').value;
        const desc = document.getElementById('task-desc').value;
        const deadline = document.getElementById('task-deadline').value;

        if (!desc) {
            showToast("è¯·è¾“å…¥ä½œä¸šå†…å®¹å“¦ï¼");
            return;
        }

        const newTask = {
            id: Date.now(),
            subject: subject,
            desc: desc,
            deadline: deadline,
            status: 'pending', // pending, waiting, done
            createTime: new Date().getTime()
        };

        appData.tasks.unshift(newTask); // æ–°ä»»åŠ¡åœ¨æœ€å‰
        document.getElementById('task-desc').value = ''; // æ¸…ç©ºè¾“å…¥
        saveData();
        showToast("ä½œä¸šæ·»åŠ æˆåŠŸï¼åŠ æ²¹ï¼");
    }

    function renderTasks() {
        const list = document.getElementById('task-list-container');
        list.innerHTML = '';

        if (appData.tasks.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:#ccc; padding:20px;">è¿˜æ²¡æœ‰ä½œä¸šå“¦ï¼Œå»ç©ä¸€ä¼šå„¿å§~ ğŸ‰</div>';
            return;
        }

        appData.tasks.forEach(task => {
            let statusHtml = '';
            let cardClass = 'status-pending';

            if (task.status === 'pending') {
                statusHtml = `<button class="action-btn btn-finish" onclick="markWaiting(${task.id})">æˆ‘åšå®Œå•¦</button>`;
            } else if (task.status === 'waiting') {
                cardClass = 'status-waiting';
                statusHtml = `<button class="action-btn btn-verify" onclick="openVerifyModal(${task.id})">å®¶é•¿æ£€æŸ¥</button>`;
            } else {
                cardClass = 'status-done';
                statusHtml = `<span class="done-badge">ğŸŒº å·²å¥–åŠ±</span>`;
            }

            // æ ¼å¼åŒ–æ—¶é—´
            const d = new Date(task.deadline);
            const timeStr = isNaN(d.getTime()) ? 'æ— æˆªæ­¢æ—¶é—´' : `${d.getMonth()+1}æœˆ${d.getDate()}æ—¥ ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;

            const li = document.createElement('li');
            li.className = `task-card ${cardClass}`;
            li.innerHTML = `
                <div class="task-info">
                    <h3><span class="task-subject">${task.subject}</span> ${task.desc}</h3>
                    <p>ğŸ•’ æˆªæ­¢: ${timeStr}</p>
                </div>
                <div>${statusHtml}</div>
                ${task.status !== 'done' ? `<div style="margin-left:10px; cursor:pointer; color:#ccc" onclick="deleteTask(${task.id})">âœ•</div>` : ''}
            `;
            list.appendChild(li);
        });
    }

    function deleteTask(id) {
        if(confirm("ç¡®å®šåˆ é™¤è¿™ä¸ªä½œä¸šå—ï¼Ÿ")) {
            appData.tasks = appData.tasks.filter(t => t.id !== id);
            saveData();
        }
    }

    function markWaiting(id) {
        const task = appData.tasks.find(t => t.id === id);
        if (task) {
            task.status = 'waiting';
            saveData();
            showToast("çœŸæ£’ï¼å¿«å»å«çˆ¸çˆ¸å¦ˆå¦ˆæ¥æ£€æŸ¥å§~");
        }
    }

    // --- å®¶é•¿å®¡æ ¸é€»è¾‘ ---
    let currentVerifyId = null;

    function openVerifyModal(id) {
        currentVerifyId = id;
        document.getElementById('parent-pin').value = '';
        document.getElementById('parent-modal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('parent-modal').style.display = 'none';
        currentVerifyId = null;
    }

    function verifyParent() {
        const pin = document.getElementById('parent-pin').value;
        if (pin === DEFAULT_PIN) {
            confirmTaskDone(currentVerifyId);
            closeModal();
        } else {
            alert("å¯†ç é”™è¯¯å“¦ï¼");
        }
    }

    function confirmTaskDone(id) {
        const task = appData.tasks.find(t => t.id === id);
        if (task) {
            task.status = 'done';
            // ç§¯åˆ†è§„åˆ™ï¼šè¿™é‡Œè®¾å®šä¸€ä¸ªä½œä¸š +5 åˆ†
            const pointsEarned = 5;
            appData.score += pointsEarned;
            saveData();
            
            // æ’­æ”¾ç‰¹æ•ˆ
            createFlower(window.innerWidth / 2, window.innerHeight / 2);
            showToast(`ä½œä¸šå®Œæˆï¼è·å¾— ${pointsEarned} ä¸ªå°çº¢èŠ±ç§¯åˆ†ï¼`);
        }
    }

    // --- å•†åŸé€»è¾‘ ---
    function renderMall() {
        const grid = document.getElementById('mall-container');
        grid.innerHTML = '';
        
        appData.products.forEach(p => {
            const canBuy = appData.score >= p.price;
            const item = document.createElement('div');
            item.className = 'product-card';
            item.innerHTML = `
                <span class="product-icon">${p.icon}</span>
                <div style="font-weight:bold">${p.name}</div>
                <div class="product-price">ğŸŒº ${p.price}</div>
                <button class="btn-buy" ${!canBuy ? 'disabled' : ''} onclick="buyProduct(${p.id})">
                    ${canBuy ? 'ç«‹å³å…‘æ¢' : 'ç§¯åˆ†ä¸è¶³'}
                </button>
            `;
            grid.appendChild(item);
        });
    }

    function buyProduct(id) {
        const product = appData.products.find(p => p.id === id);
        if (product && appData.score >= product.price) {
            if(confirm(`ç¡®å®šè¦èŠ± ${product.price} ç§¯åˆ†å…‘æ¢ "${product.name}" å—ï¼Ÿ`)) {
                appData.score -= product.price;
                saveData();
                showToast(`å…‘æ¢æˆåŠŸï¼å¿«å»æ‰¾çˆ¸çˆ¸å¦ˆå¦ˆé¢†å¥–å§ï¼`);
                // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å…‘æ¢è®°å½•é€»è¾‘
            }
        }
    }

    // --- å·¥å…·å‡½æ•° ---
    function showToast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.style.opacity = 1;
        setTimeout(() => { t.style.opacity = 0; }, 2000);
    }

    function createFlower(x, y) {
        const flower = document.createElement('div');
        flower.innerText = 'ğŸŒº';
        flower.className = 'flower-anim';
        flower.style.left = x + 'px';
        flower.style.top = y + 'px';
        document.body.appendChild(flower);
        setTimeout(() => flower.remove(), 1500);
    }

</script>

</body>
</html>
